

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>VHDL temp &mdash; FPGA 在中低能实验核物理中的应用 编写中 文档</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="LPM（library of parameterized mudules）" href="LPM.html" />
    <link rel="prev" title="verilog 临时存放" href="tempverilog.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> FPGA 在中低能实验核物理中的应用
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">README</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ISE/Altera/Vivado软件</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Install.html">软件安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="ISE.html">ISE 软件</a></li>
<li class="toctree-l1"><a class="reference internal" href="Altera.html">Altera 软件</a></li>
<li class="toctree-l1"><a class="reference internal" href="Vivado.html">Vivado 软件</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">语法</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="VHDL.html">VHDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="verilog.html">verilog</a></li>
<li class="toctree-l1"><a class="reference internal" href="TimingConstraints.html">时序约束</a></li>
<li class="toctree-l1"><a class="reference internal" href="Primitive.html">原语</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">硬件介绍</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="LUPO.html">LUPO</a></li>
<li class="toctree-l1"><a class="reference internal" href="DT5495.html">DT5495</a></li>
<li class="toctree-l1"><a class="reference internal" href="MZTIO.html">MZTIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="DT5550.html">DT5550</a></li>
<li class="toctree-l1"><a class="reference internal" href="R5560.html">R5560</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">计数器</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="counter.html">计数器</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">状态机</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FSM.html">状态机</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FIFO</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FIFO.html">FIFO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HLS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="HLS.html">高层次综合</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">经验总结</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="exp.html">经验总结</a></li>
<li class="toctree-l1"><a class="reference internal" href="tempverilog.html">verilog 临时存放</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">VHDL temp</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">缩位与/缩位或运算</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">循环</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">信号处理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hls">HLS 生成模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">手写模块</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="LPM.html">LPM（library of parameterized mudules）</a></li>
<li class="toctree-l1"><a class="reference internal" href="attribute.html">attribute</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">FPGA 在中低能实验核物理中的应用</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>VHDL temp</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/tempvhdl.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="vhdl-temp">
<h1>VHDL temp<a class="headerlink" href="#vhdl-temp" title="永久链接至标题">¶</a></h1>
<section id="id1">
<h2>缩位与/缩位或运算<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>缩位运算符，即 “reduction operator”。对于 VHDL 来说，很少有人知道其缩位运算符是什么。首先缩位运算的意思是把一个 vector 合并成一位，例如缩位与运算符：对于一个 std_logic_vector 名为 example 的变量，完成 examlle[0] and example[1] and … and example[22] 这样的运算的运算符。</p>
<ul class="simple">
<li><p>对于VHDL-2008，直接用and就可以完成：and(example);</p></li>
<li><p>用组合逻辑自己写一个函数，按位或/与即可。</p></li>
<li><p>or_reduce 和 and_reduce 也可以完成上面的内容。要主要包含头文件 std_logic_misc。</p></li>
</ul>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">and_reduct</span><span class="p">(</span><span class="n">slv</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic_vector</span><span class="p">)</span> <span class="k">return</span> <span class="kt">std_logic</span> <span class="k">is</span>
  <span class="k">variable</span> <span class="n">res_v</span> <span class="o">:</span> <span class="kt">std_logic</span> <span class="o">:=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>  <span class="c1">-- Null slv vector will also return &#39;1&#39;</span>
<span class="k">begin</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">slv</span><span class="na">&#39;range</span> <span class="k">loop</span>
    <span class="n">res_v</span> <span class="o">:=</span> <span class="n">res_v</span> <span class="k">and</span> <span class="n">slv</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">res_v</span><span class="p">;</span>
<span class="k">end</span> <span class="k">function</span><span class="p">;</span>
<span class="c1">-- You can then use the function both inside and outside functions with:</span>

<span class="k">signal</span> <span class="n">arg</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">signal</span> <span class="n">res</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
<span class="c1">-- ...</span>
<span class="n">res</span> <span class="o">&lt;=</span> <span class="n">and_reduct</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>循环<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">N_HISTOGRAM_REGS</span><span class="o">-</span><span class="mi">1</span> <span class="k">loop</span>
  <span class="n">tmp_histogram</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">to_unsigned</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N_HISTOGRAM_BIT</span><span class="p">));</span>
<span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="nc">dettrigA</span><span class="o">:</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">31</span> <span class="k">generate</span>
  <span class="k">process</span><span class="p">(</span><span class="n">clk100</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="k">if</span><span class="p">(</span><span class="n">clk100</span><span class="na">&#39;event</span> <span class="k">and</span> <span class="n">clk100</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span><span class="k">then</span>
      <span class="k">if</span><span class="p">(</span><span class="n">A0</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="sc">&#39;1&#39;</span> <span class="k">and</span> <span class="n">A1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="sc">&#39;0&#39;</span><span class="p">)</span><span class="k">then</span>
        <span class="n">triggerA</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">triggerA</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>
<span class="k">end</span> <span class="k">generate</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="id3">
<h2>信号处理<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<section id="hls">
<h3>HLS 生成模块<a class="headerlink" href="#hls" title="永久链接至标题">¶</a></h3>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">BaselineRestorer</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">CLK</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">TRIGGER</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--原始波形触发信号</span>
    <span class="n">DATA_IN</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span><span class="mi">15</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--输入原始波形</span>
    <span class="n">M_LENGTH</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">INTEGER</span><span class="p">;</span><span class="c1">--2^n 参与基线计算的时间窗长度</span>
    <span class="n">BL_HOLD</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">INTEGER</span><span class="p">;</span><span class="c1">--触发之后禁止基线计算的点的个数</span>
    <span class="n">FLUSH</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">BASELINE</span><span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span><span class="mi">15</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--输出基线</span>
    <span class="n">BASELINE_VALID</span><span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--基线有效标记</span>
    <span class="n">HOLD_TIME</span><span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--不计算基线的时间</span>
    <span class="n">RUNNING_NOT_HOLD</span><span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="c1">--正在计算基线的标记</span>
    <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">moving_average</span> <span class="k">is</span>
<span class="k">port</span> <span class="p">(</span>
    <span class="n">ap_clk</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">ap_rst</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">adc_data_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">adc_data_V_ap_vld</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">hold</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">length_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">dataout_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">dataout_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span> <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">charge_integration</span> <span class="k">is</span>
<span class="k">port</span> <span class="p">(</span>
    <span class="n">ap_clk</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">ap_rst</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">in1_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--输入波形</span>
    <span class="n">in1_V_ap_vld</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">-- &#39;1&#39;</span>
    <span class="n">base_line_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--输入基线</span>
    <span class="n">trigger_signal</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--输入触发</span>
    <span class="n">p_int_length_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--积分门宽</span>
    <span class="n">p_pre_length_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--积分起始点，触发前</span>
    <span class="n">p_gain_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--增益</span>
    <span class="n">p_offset_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--偏置</span>
    <span class="n">p_pileup_inib_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--堆积拒绝的事件间隔</span>
    <span class="n">enable</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">-- &#39;1&#39;</span>
    <span class="n">energy_out_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--输出积分结果</span>
    <span class="n">energy_trigger</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">-- 标记输出积分有效</span>
    <span class="n">energy_trigger_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">-- open</span>
    <span class="n">p_integrate</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">-- 积分门</span>
    <span class="n">p_pileup</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">-- 堆积标记</span>
    <span class="n">p_busy</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span> <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">trapezio</span> <span class="k">is</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">ap_clk</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">ap_rst</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">adc_data_V</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span> <span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">adc_data_V_ap_vld</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">baseline_V</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span> <span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">k_V</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span> <span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">m_V</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span> <span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">M_V_r</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span> <span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">G_V</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span> <span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">dataout_V</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span> <span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">dataout_V_ap_vld</span> <span class="o">:</span> <span class="k">out</span> <span class="kt">STD_LOGIC</span>
  <span class="p">);</span>
  <span class="k">attribute</span> <span class="n">NotValidForBitStream</span> <span class="o">:</span> <span class="kt">boolean</span><span class="p">;</span>
  <span class="k">attribute</span> <span class="n">NotValidForBitStream</span> <span class="k">of</span> <span class="n">trapezio</span> <span class="o">:</span> <span class="k">entity</span> <span class="nc">is</span> <span class="n">true</span><span class="p">;</span>
<span class="k">end</span> <span class="nc">trapezio</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">MCAHP_512</span> <span class="k">is</span>
<span class="k">port</span> <span class="p">(</span>
    <span class="n">ap_clk</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">ap_rst</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">adc_data_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">positive_r</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">digital_offset_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">threshold_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">trig_k_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--快速滤波梯形上升时间</span>
    <span class="n">trig_m_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--快速滤波梯形上升+平台时间</span>
    <span class="n">e_k_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--梯形上升时间</span>
    <span class="n">e_m_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--梯形上升+平台时间</span>
    <span class="n">e_MDec_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">23</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">-- int(256/(exp(clock_sampling_time/tau)-1))</span>
    <span class="n">e_G_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">23</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--int(gain*0x10000)  gain为浮点数</span>
    <span class="n">e_MDec2_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">e_G2_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">e_sample_delay_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">baseline_len_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--2^n    5-&gt;32  6-&gt;64  7-&gt;128 8-&gt;256  9-&gt;512  10-&gt;1024  11-&gt;2048</span>
    <span class="n">baseline_inib_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--触发之后抑制基线计算的时间，需要大于两倍能量梯形的上升和平台之和</span>
    <span class="n">run_cfg</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">-- &#39;1&#39;</span>
    <span class="n">deconv2_sig_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--open</span>
    <span class="n">deconv2_sig_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--open</span>
    <span class="n">trigger_delta_monitor_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--open</span>
    <span class="n">trigger_delta_monitor_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--open</span>
    <span class="n">trigger_trap_monitor_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--触发滤波</span>
    <span class="n">trigger_trap_monitor_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">trap_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--梯形滤波</span>
    <span class="n">trap_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">trap_minus_baseline_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--梯形滤波减基线滤波</span>
    <span class="n">trap_minus_baseline_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">baseline_out_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--基线滤波</span>
    <span class="n">baseline_out_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">energy_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--能量滤波</span>
    <span class="n">energy_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">energy_strobe</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--能量采集标记</span>
    <span class="n">trigger_sig</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--触发信号</span>
    <span class="n">baseline_hold</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">GIN_SELECT_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">3</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">gin</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span> <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">gated_integrator</span> <span class="k">is</span>
<span class="k">port</span> <span class="p">(</span>
    <span class="n">ap_clk</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--时钟</span>
    <span class="n">ap_rst</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--重置，高电平有效</span>
    <span class="n">data_in_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--输入数据</span>
    <span class="n">data_in_V_ap_vld</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--输入数据有效标记</span>
    <span class="n">gate_len_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--积分门宽，最大到1024</span>
    <span class="n">gain_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--增益，65536表示增益为1。算法为 gain/65536</span>
    <span class="n">clear</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--从高电平到低电平时，重新初始化。初始化时间与积分门宽成正比。这期间 data_out_V_ap_vld/ready为低电平</span>
    <span class="n">data_out_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--数据输出，当前时钟之前的积分门结果输出延迟4个时钟</span>
    <span class="n">data_out_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--输出数据有效标记</span>
    <span class="n">ready</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span> <span class="c1">--高电平表示输出有效，低电平表示在初始化</span>
    <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="c1">-- 数值导数/微分</span>
<span class="c1">-- OUT[n] = DATA_IN[n]  - DATA_IN[n-WINDOW])</span>
<span class="k">entity</span> <span class="nc">differenziator</span> <span class="k">is</span>
<span class="k">port</span> <span class="p">(</span>
    <span class="n">ap_clk</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--时钟</span>
    <span class="n">ap_rst</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--重置，高电平有效</span>
    <span class="n">data_in_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--输入数据</span>
    <span class="n">data_in_V_ap_vld</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--输入数据有效标记</span>
    <span class="n">diff_len_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--前后做差两个点的间隔，最大为999</span>
    <span class="n">clear</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">----从高电平到低电平时，重新初始化。初始化时间最小为WINDOW。这期间 data_out_V_ap_vld/ready为低电平</span>
    <span class="n">data_out_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--当前时钟输入数据与之前数据的差输出延迟两个时钟</span>
    <span class="n">data_out_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--数据输出，当前时钟输入数据的输出延迟2个时钟</span>
    <span class="n">ready</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--输出数据有效标记</span>
    <span class="n">ready_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span> <span class="c1">--输出常为1, open</span>
    <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">PSD_INTDUAL</span> <span class="k">is</span>
<span class="k">port</span> <span class="p">(</span>
    <span class="n">ap_clk</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">ap_rst</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">data_in_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">data_in_V_ap_vld</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">trigger</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">int_short_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">int_long_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">pileup_inib_V</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">15</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">psd_out_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">psd_out_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">q_long_out_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">q_long_out_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">q_short_out_V</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">q_short_out_V_ap_vld</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span> <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3>手写模块<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="c1">-- 1,2,4,8 个点平均</span>
<span class="k">entity</span> <span class="nc">NoiseFilter</span> <span class="k">is</span>
  <span class="k">Generic</span> <span class="p">(</span><span class="n">data_bit</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">16</span><span class="p">);</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">CLK</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">MODE</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span><span class="c1">-- &quot;00&quot;=&gt;1  &quot;01&quot;=&gt;2  &quot;10&quot;=&gt;4  &quot;11&quot;=&gt;8</span>
    <span class="n">DATA_IN</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="n">data_bit</span><span class="o">-</span><span class="mi">1</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">DATA_OUT</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="n">data_bit</span><span class="o">-</span><span class="mi">1</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">TriggerDerivative</span> <span class="k">is</span>
  <span class="k">Generic</span> <span class="p">(</span>
    <span class="n">data_bit</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">16</span><span class="p">;</span><span class="c1">--输入波形位数</span>
    <span class="n">noise_filter</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span><span class="c1">--计算两个间隔为n的点的差值为滤波结果</span>
    <span class="n">data_delay</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">3</span><span class="c1">--输入波形的延迟输出</span>
    <span class="p">);</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">CLK</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">POLARITY</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">-- 1=&gt;pos 0=&gt;neg</span>
    <span class="n">DATA_IN</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span><span class="n">data_bit</span><span class="o">-</span><span class="mi">1</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">THRESHOLD</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span><span class="n">data_bit</span><span class="o">-</span><span class="mi">1</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">DELAYED_DATA</span><span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span><span class="n">data_bit</span><span class="o">-</span><span class="mi">1</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">TRIGGER</span><span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span>
    <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">TriggerLeading</span> <span class="k">is</span>
  <span class="k">Generic</span> <span class="p">(</span>
    <span class="n">data_bit</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">16</span><span class="p">;</span><span class="c1">--输入波形位数</span>
    <span class="n">data_delay</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">3</span><span class="c1">--输入波形的延迟输出</span>
    <span class="p">);</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">CLK</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span>
    <span class="n">POLARITY</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC</span><span class="p">;</span><span class="c1">--1=&gt;pos 0=&gt;neg</span>
    <span class="n">DATA_IN</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span><span class="n">data_bit</span><span class="o">-</span><span class="mi">1</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">THRESHOLD</span><span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span><span class="n">data_bit</span><span class="o">-</span><span class="mi">1</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">DELAYED_DATA</span><span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span><span class="n">data_bit</span><span class="o">-</span><span class="mi">1</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">TRIGGER</span><span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC</span>
    <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">LOGIC_ANALYZER</span> <span class="k">is</span>
  <span class="k">Generic</span> <span class="p">(</span>
    <span class="n">bitsize</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">32</span><span class="p">;</span><span class="c1">--通道数，最大256</span>
    <span class="n">fifolength</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">16</span><span class="p">);</span>
  <span class="k">port</span> <span class="p">(</span>
    <span class="n">RESET</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">0</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--重置</span>
    <span class="n">CLK_READ</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">0</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--时钟</span>
    <span class="n">CLK_WRITE</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">0</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--时钟</span>
    <span class="n">DATAIN</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="n">bitsize</span><span class="o">-</span><span class="mi">1</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--数据输入</span>
    <span class="n">TRIGGER</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">0</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--外部输入触发</span>
    <span class="n">FULL</span><span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">0</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">READ_DATA</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">READ_DATAVALID</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">0</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">READ_NEXT</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">0</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">STATUS</span> <span class="o">:</span> <span class="k">OUT</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--[0]1表示数据可以读取  [1]1表示已经初始化，0表示重置或者等待触发中   [2]1表示已经初始化，0表示重置或者数据已经写入FIFO完成</span>
    <span class="n">CONFIG</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--[0]1表示enable [1]1表示reset [2]1表示外部输入TRIGGER触发 [3]1表示上升沿或者下降沿触发 [4]1表示软件触发</span>
    <span class="n">CONFIG0</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--0-31通道是否开启上升沿触发</span>
    <span class="n">CONFIG1</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--32-63通道是否开启上升沿触发</span>
    <span class="n">CONFIG2</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--后面以此类推</span>
    <span class="n">CONFIG3</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CONFIG4</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CONFIG5</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CONFIG6</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CONFIG7</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CONFIG8</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--0-31通道是否开启下降沿触发</span>
    <span class="n">CONFIG9</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--32-63通道是否开启下降沿触发</span>
    <span class="n">CONFIGA</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span><span class="c1">--后面以此类推</span>
    <span class="n">CONFIGB</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CONFIGC</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CONFIGD</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CONFIGE</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CONFIGF</span> <span class="o">:</span> <span class="k">IN</span> <span class="kt">STD_LOGIC_VECTOR</span> <span class="p">(</span><span class="mi">31</span> <span class="k">DOWNTO</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="LPM.html" class="btn btn-neutral float-right" title="LPM（library of parameterized mudules）" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="tempverilog.html" class="btn btn-neutral float-left" title="verilog 临时存放" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2020, Hongyi Wu(吴鸿毅).

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>